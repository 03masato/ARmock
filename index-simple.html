<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARã‚­ãƒ£ãƒƒãƒˆ - ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="app">
        <header class="site-header">
            <div class="container flex items-center justify-between">
                <div class="logo">Aha!ãƒ‡ãƒ¢</div>
            </div>
        </header>

        <main>
            <section class="hero">
                <div class="container text-center">
                    <h1>ARã‚­ãƒ£ãƒƒãƒˆ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</h1>
                    <p>ã‚«ãƒ¡ãƒ©ã‚’ä½¿ã£ã¦çŒ«ã‚’æ•ã¾ãˆã‚ˆã†!<br>10ç§’é–“ã§ã§ãã‚‹ã ã‘å¤šãã®çŒ«ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã­ã€‚</p>
                    <button id="start-ar-btn" class="btn btn-primary" style="margin-top: 20px;">
                        ARã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã™ã‚‹
                    </button>
                    <p id="status" style="margin-top: 10px; color: #666;"></p>
                </div>
            </section>
        </main>
    </div>

    <section id="game-screen" class="game-screen hidden">
        <div class="game-container">
            <div class="camera-view-container">
                <video id="camera-feed" autoplay playsinline muted></video>
                <div id="ar-cat" class="ar-cat-character hidden">
                    <div class="cat-name-tag">ãƒŸã‚± ğŸ±</div>
                    <div style="font-size: 100px;">ğŸ±</div>
                </div>
            </div>

            <div id="pre-game-ui" class="pre-game-ui">
                <h2>æº–å‚™å®Œäº†!</h2>
                <button id="start-game-btn" class="btn btn-primary">Start Game</button>
            </div>

            <div id="game-hud" class="game-hud hidden">
                <div class="hud-item timer">æ®‹ã‚Šæ™‚é–“: <span id="timer-display">10</span>ç§’</div>
                <div class="hud-item score">æ•ã¾ãˆãŸçŒ«: <span id="score-display">0</span>åŒ¹</div>
            </div>
        </div>
    </section>

    <section id="result-screen" class="result-screen hidden">
        <div class="container text-center">
            <h2>ã‚²ãƒ¼ãƒ çµ‚äº†!</h2>
            <div class="result-card">
                <div class="result-icon">ğŸ±</div>
                <div class="result-label">æ•ã¾ãˆãŸçŒ«</div>
                <div id="final-score" class="final-score">0</div>
                <div class="result-message">åŒ¹</div>
            </div>
            <button id="play-again-btn" class="btn btn-primary">Play Again</button>
            <button id="back-to-top-btn" class="btn btn-secondary" style="margin-top: 10px;">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
        </div>
    </section>

    <script>
        console.log('Simple script loaded');

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded');

            const app = document.getElementById('app');
            const gameScreen = document.getElementById('game-screen');
            const resultScreen = document.getElementById('result-screen');
            const startArBtn = document.getElementById('start-ar-btn');
            const startGameBtn = document.getElementById('start-game-btn');
            const playAgainBtn = document.getElementById('play-again-btn');
            const backToTopBtn = document.getElementById('back-to-top-btn');
            const cameraFeed = document.getElementById('camera-feed');
            const preGameUi = document.getElementById('pre-game-ui');
            const gameHud = document.getElementById('game-hud');
            const arCat = document.getElementById('ar-cat');
            const statusText = document.getElementById('status');

            console.log('Elements:', {
                app: !!app,
                gameScreen: !!gameScreen,
                startArBtn: !!startArBtn
            });

            let gameState = {
                score: 0,
                timeLeft: 10,
                isPlaying: false,
                timerInterval: null
            };

            if (startArBtn) {
                startArBtn.addEventListener('click', async () => {
                    console.log('Start button clicked');
                    statusText.textContent = 'ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ä¸­...';

                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: { facingMode: 'environment' }
                        });

                        console.log('Camera obtained');
                        cameraFeed.srcObject = stream;
                        await cameraFeed.play();

                        app.classList.add('hidden');
                        gameScreen.classList.remove('hidden');
                        console.log('Game screen shown');
                    } catch (err) {
                        console.error('Camera error:', err);
                        statusText.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + err.message;
                        alert('ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™');
                    }
                });
            }

            if (startGameBtn) {
                startGameBtn.addEventListener('click', () => {
                    console.log('Start game clicked');
                    gameState.score = 0;
                    gameState.timeLeft = 10;
                    gameState.isPlaying = true;

                    document.getElementById('score-display').textContent = '0';
                    document.getElementById('timer-display').textContent = '10';
                    preGameUi.classList.add('hidden');
                    gameHud.classList.remove('hidden');
                    arCat.classList.remove('hidden');

                    gameState.timerInterval = setInterval(() => {
                        gameState.timeLeft--;
                        document.getElementById('timer-display').textContent = gameState.timeLeft;

                        if (gameState.timeLeft <= 0) {
                            endGame();
                        }
                    }, 1000);

                    arCat.addEventListener('click', () => {
                        if (gameState.isPlaying) {
                            gameState.score++;
                            document.getElementById('score-display').textContent = gameState.score;
                        }
                    });
                });
            }

            function endGame() {
                gameState.isPlaying = false;
                clearInterval(gameState.timerInterval);
                arCat.classList.add('hidden');
                document.getElementById('final-score').textContent = gameState.score;
                gameScreen.classList.add('hidden');
                resultScreen.classList.remove('hidden');
            }

            if (playAgainBtn) {
                playAgainBtn.addEventListener('click', () => {
                    resultScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                    preGameUi.classList.remove('hidden');
                    gameHud.classList.add('hidden');
                });
            }

            if (backToTopBtn) {
                backToTopBtn.addEventListener('click', () => {
                    if (cameraFeed.srcObject) {
                        cameraFeed.srcObject.getTracks().forEach(track => track.stop());
                    }
                    resultScreen.classList.add('hidden');
                    gameScreen.classList.add('hidden');
                    app.classList.remove('hidden');
                });
            }
        });
    </script>
</body>

</html>